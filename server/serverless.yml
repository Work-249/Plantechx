service: academic-management-backend
frameworkVersion: "3"

provider:
  name: aws
  runtime: nodejs20.x
  region: ap-south-1
  stage: prod
  timeout: 20
  memorySize: 512
  environment:
    AWS_REGION: ap-south-1
    JWT_SECRET: ${env:JWT_SECRET}
    NODE_ENV: ${env:NODE_ENV, 'production'}
    FRONTEND_URL: ${env:FRONTEND_URL, 'https://main.daqm1aijotilg.amplifyapp.com'}
    DYNAMODB_USERS_TABLE: ${env:DYNAMODB_USERS_TABLE, 'AcademicManagement-Users'}
    DYNAMODB_COLLEGES_TABLE: ${env:DYNAMODB_COLLEGES_TABLE, 'AcademicManagement-Colleges'}
    DYNAMODB_TESTS_TABLE: ${env:DYNAMODB_TESTS_TABLE, 'AcademicManagement-Tests'}
    DYNAMODB_TEST_ASSIGNMENTS_TABLE: ${env:DYNAMODB_TEST_ASSIGNMENTS_TABLE, 'AcademicManagement-TestAssignments'}
    DYNAMODB_TEST_ATTEMPTS_TABLE: ${env:DYNAMODB_TEST_ATTEMPTS_TABLE, 'AcademicManagement-TestAttempts'}
    DYNAMODB_CODING_QUESTIONS_TABLE: ${env:DYNAMODB_CODING_QUESTIONS_TABLE, 'AcademicManagement-CodingQuestions'}
    DYNAMODB_SUBJECTS_TABLE: ${env:DYNAMODB_SUBJECTS_TABLE, 'AcademicManagement-Subjects'}
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:Query
        - dynamodb:Scan
        - dynamodb:GetItem
        - dynamodb:PutItem
        - dynamodb:UpdateItem
        - dynamodb:DeleteItem
      Resource:
        - arn:aws:dynamodb:ap-south-1:*:table/AcademicManagement-*

functions:
  api:
    handler: index.handler
    events:
      - httpApi:
          path: /{proxy+}
          method: ANY

plugins:
  - serverless-dotenv-plugin
  - serverless-plugin-tracing

package:
  patterns:
    - "!node_modules/aws-sdk/**"
